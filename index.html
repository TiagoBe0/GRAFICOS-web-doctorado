<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline ML - Predicci√≥n de Vacancias en Nanoporos</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .info-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .info-section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-card.build {
            border-color: #27ae60;
        }
        
        .info-card.train {
            border-color: #3498db;
        }
        
        .info-card.predict {
            border-color: #e74c3c;
        }
        
        .info-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .info-card ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-card li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .info-card li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #95a5a6;
        }
        
        .diagram-container {
            padding: 40px;
            background: white;
            overflow-x: auto;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            min-width: 100%;
        }
        
        .legend {
            padding: 30px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
        }
        
        .legend h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        footer {
            padding: 20px;
            text-align: center;
            background: #2c3e50;
            color: white;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Pipeline de Machine Learning para Predicci√≥n de Vacancias</h1>
            <p>Sistema de an√°lisis de nanoporos mediante OVITO + Convex Hull + Mean Shift Clustering</p>
        </header>
        
        <div class="info-section">
            <h2>Descripci√≥n del Sistema</h2> <a href="features.html"></a>
            <div class="info-grid">
                <div class="info-card build">
                    <h3>üî® BUILD - Construcci√≥n del Dataset</h3>
                    <ul>
                        <li>Preprocesamiento con OVITO (superficie)</li>
                        <li>C√°lculo de vacancias totales (16384 - n_√°tomos)</li>
                        <li>Mean Shift Clustering espacial</li>
                        <li>Extracci√≥n de ~200+ features geom√©tricas</li>
                        <li>Convex Hull, momentos de inercia, RDF</li>
                        <li>Features topol√≥gicas y de conectividad</li>
                    </ul>
                </div>
                
                <div class="info-card train">
                    <h3>üéì TRAIN - Entrenamiento del Modelo</h3>
                    <ul>
                        <li>Random Forest Regressor (400 √°rboles)</li>
                        <li>Validaci√≥n cruzada K-Fold (5 splits)</li>
                        <li>Pipeline sklearn completo</li>
                        <li>Imputer + Scaler + RF</li>
                        <li>An√°lisis de feature importance</li>
                        <li>Eliminaci√≥n de features prohibidas</li>
                    </ul>
                </div>
                
                <div class="info-card predict">
                    <h3>üîÆ PREDICT - Predicci√≥n de Vacancias</h3>
                    <ul>
                        <li>Carga del modelo entrenado</li>
                        <li>Procesamiento id√©ntico a BUILD</li>
                        <li>OVITO + features completas</li>
                        <li>Alineaci√≥n con features del modelo</li>
                        <li>Predicci√≥n con pipeline</li>
                        <li>C√°lculo de errores (si hay ground truth)</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
graph TD
    Start([Inicio]) --> CmdChoice{Comando seleccionado}
    
    %% BUILD BRANCH
    CmdChoice -->|build| B1[Leer archivos dump LAMMPS]
    B1 --> B2[Importar archivo en OVITO]
    B2 --> B3[Aplicar ConstructSurfaceModifier<br/>radius=2, smoothing=12]
    B3 --> B4[Computar datos completos]
    B4 --> B5[Calcular vacancias:<br/>16384 - n_√°tomos]
    B5 --> B6[Invertir selecci√≥n<br/>InvertSelectionModifier]
    B6 --> B7[Eliminar √°tomos no superficiales<br/>DeleteSelectedModifier]
    B7 --> B8[Extraer coordenadas<br/>√°tomos de superficie]
    B8 --> B9[Mean Shift Clustering<br/>en espacio 3D]
    B9 --> B10[Calcular features de clustering<br/>n_clusters, bandwidth, etc.]
    B10 --> B11[Exportar archivo procesado<br/>_surface.dump]
    B11 --> B12[Leer archivo procesado]
    B12 --> B13[Calcular Convex Hull<br/>volumen, √°rea, v√©rtices]
    B13 --> B14[Momentos de Inercia<br/>tensor, anisotrop√≠a]
    B14 --> B15[Distribuci√≥n Radial RDF<br/>20 bins + estad√≠sticas]
    B15 --> B16[Conectividad Espacial<br/>clusters, aislamiento]
    B16 --> B17[Curvatura de Superficie<br/>aproximaci√≥n local]
    B17 --> B18[Features Topol√≥gicas<br/>dimensi√≥n fractal, gradientes]
    B18 --> B19[An√°lisis de Capas<br/>estructura radial]
    B19 --> B20[Entrop√≠a Espacial<br/>desorden del sistema]
    B20 --> B21[Features At√≥micas<br/>energ√≠a, stress, coordinaci√≥n]
    B21 --> B22[Agregar todas las features<br/>+ vacancias calculadas]
    B22 --> B23{¬øM√°s archivos?}
    B23 -->|S√≠| B1
    B23 -->|No| B24[Crear DataFrame<br/>con todos los resultados]
    B24 --> B25[Eliminar features prohibidas<br/>n_atoms, vacancy_fraction, etc.]
    B25 --> B26[Guardar dataset CSV<br/>dataset_ovito_convexhull_meanshift.csv]
    B26 --> EndBuild([Fin Build])
    
    %% TRAIN BRANCH
    CmdChoice -->|train| T1[Leer dataset CSV]
    T1 --> T2[Verificar y eliminar<br/>features prohibidas]
    T2 --> T3[Separar target y:<br/>vacancies]
    T3 --> T4[Separar features X:<br/>drop vacancies, n_atoms_surface]
    T4 --> T5[Seleccionar solo<br/>columnas num√©ricas]
    T5 --> T6[Crear Pipeline sklearn:<br/>Imputer + Scaler + RandomForest]
    T6 --> T7[Configurar Random Forest:<br/>400 √°rboles, max_depth=None]
    T7 --> T8[Validaci√≥n Cruzada<br/>K-Fold = 5]
    T8 --> T9[Calcular m√©tricas:<br/>MAE, RMSE, R¬≤]
    T9 --> T10[Train/Test Split<br/>80/20]
    T10 --> T11[Entrenar modelo final<br/>con datos de entrenamiento]
    T11 --> T12[Evaluar en test set]
    T12 --> T13[Calcular Feature Importance<br/>del Random Forest]
    T13 --> T14[Crear bundle del modelo:<br/>pipe + metadata]
    T14 --> T15[Guardar modelo<br/>vacancy_model_complete_ss4.joblib]
    T15 --> T16[Guardar importancias<br/>feature_importance_complete_ss4.csv]
    T16 --> EndTrain([Fin Train])
    
    %% PREDICT BRANCH
    CmdChoice -->|predict| P1[Cargar modelo joblib]
    P1 --> P2[Extraer pipeline y<br/>lista de features]
    P2 --> P3[Buscar archivos<br/>seg√∫n patr√≥n de entrada]
    P3 --> P4[Para cada archivo:<br/>Aplicar pipeline completo]
    P4 --> P5[OVITO: Superficie + Clustering]
    P5 --> P6[Extraer todas las features<br/>igual que en BUILD]
    P6 --> P7{¬øM√°s archivos?}
    P7 -->|S√≠| P4
    P7 -->|No| P8[Crear DataFrame<br/>con features extra√≠das]
    P8 --> P9[Eliminar features prohibidas]
    P9 --> P10[Alinear columnas<br/>con features del modelo]
    P10 --> P11[Imputar features faltantes<br/>con NaN]
    P11 --> P12[Aplicar predicci√≥n<br/>pipe.predict]
    P12 --> P13[Calcular errores<br/>si hay valores reales]
    P13 --> P14[Guardar resultados<br/>predicciones_completas.csv]
    P14 --> P15[Mostrar predicciones<br/>en consola]
    P15 --> EndPredict([Fin Predict])
    
    style Start fill:#e1f5e1
    style EndBuild fill:#e1f5e1
    style EndTrain fill:#e1f5e1
    style EndPredict fill:#e1f5e1
    style B9 fill:#fff4e1
    style B13 fill:#fff4e1
    style B14 fill:#fff4e1
    style B15 fill:#fff4e1
    style T6 fill:#e1f0ff
    style T11 fill:#e1f0ff
    style P12 fill:#ffe1f0
            </div>
        </div>
        
        <div class="legend">
            <h3>Leyenda de Colores</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e1f5e1;"></div>
                    <span><strong>Verde:</strong> Puntos de inicio/fin</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fff4e1;"></div>
                    <span><strong>Naranja:</strong> C√°lculos geom√©tricos avanzados</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e1f0ff;"></div>
                    <span><strong>Azul:</strong> Operaciones de ML cr√≠ticas</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffe1f0;"></div>
                    <span><strong>Rosa:</strong> Predicci√≥n final</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p><strong>Pipeline ML para Nanoporos</strong> | Vacancy Prediction System</p>
            <p style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                OVITO + Convex Hull + Mean Shift Clustering + Random Forest
            </p>
        </footer>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>

